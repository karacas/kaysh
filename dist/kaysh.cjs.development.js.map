{"version":3,"file":"kaysh.cjs.development.js","sources":["../src/lib/_aux.ts","../src/lib/simple-cache-store.ts","../src/lib/rxjs-cache-store.ts","../src/index.ts"],"sourcesContent":["export function __strToHash(str = ''): string {\r\n  let hash = 0,\r\n    i,\r\n    chr;\r\n\r\n  for (i = 0; i < str.length; i++) {\r\n    chr = str.charCodeAt(i);\r\n    hash = (hash << 5) - hash + chr;\r\n    hash |= 0;\r\n  }\r\n\r\n  return hash.toString(36);\r\n}\r\n\r\nfunction getShortValue(val: any) {\r\n  if (Number.isInteger(val) && String(val).length) return 'num_' + val;\r\n\r\n  if (typeof val === 'string') {\r\n    if (val.length === 0) return 'emptyString__';\r\n    return 'str_' + val;\r\n  }\r\n\r\n  if (Array.isArray(val)) {\r\n    if (val.length === 0) return 'emptyArray__';\r\n\r\n    if (val.length === 1) {\r\n      if (Number.isInteger(val[0]) && String(val[0]).length) return '_num_' + val[0];\r\n\r\n      if (typeof val[0] === 'string') {\r\n        if (val[0].length === 0) return '_emptyString__';\r\n        return '_str_' + val[0];\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport function __objToHash(val: any, fast = true) {\r\n  if (val === undefined) return '__undefined__';\r\n  if (val === null) return '__null__';\r\n\r\n  if (fast) {\r\n    let shortValue = getShortValue(val);\r\n    if (shortValue != null && shortValue.length > 0 && shortValue.length < 32) return shortValue;\r\n  }\r\n\r\n  return __strToHash(JSON.stringify(val));\r\n}\r\n","import { __objToHash } from './_aux';\r\n\r\n/*\r\nTODO: More test for shareReply\r\n      More test for pip operator and localStorage\r\n*/\r\n\r\nconst _isTest = process.env.NODE_ENV === 'test';\r\n\r\nif (_isTest) if (false) console.log('test');\r\n\r\nconst _log = console.log;\r\n\r\nlet _localStorageParentKey = 'KAYSH-V1';\r\nlet _localStorageMaxGlobalTime = 0;\r\nlet _localStorage;\r\nlet _localStorageLoaded = false;\r\nlet _keyshEnabled = true;\r\nlet _keyshLocalStorageEnabled = true;\r\ndeclare var window;\r\n\r\nconst memoFuncPrefixId = 'KAYSH-CACHE-MEMO-FUNC__';\r\n\r\n_localStorage = window?.localStorage;\r\n\r\nexport interface StoredValueModelObjRoot {\r\n  [key: string]: StoredValueModelObj;\r\n}\r\n\r\nexport interface StoredValueModelObj {\r\n  [key: string]: StoredValueModel;\r\n}\r\n\r\nexport interface StoredValueModel {\r\n  value: any;\r\n  date: number;\r\n  localStored?: boolean;\r\n  config?: DefaultConfigCacheModel;\r\n}\r\n\r\nexport interface DefaultConfigCacheModel {\r\n  localStorage?: boolean;\r\n  maxTime?: number;\r\n  maxItems?: number;\r\n  useCacheReplay?: boolean;\r\n}\r\n\r\nconst defaultConfig: DefaultConfigCacheModel = {\r\n  localStorage: false,\r\n  maxTime: 0,\r\n  maxItems: 10,\r\n  useCacheReplay: true,\r\n};\r\n\r\nlet store_state: StoredValueModelObjRoot = {};\r\n\r\nfunction setCacheValue(key: string, value: any, argsToHash?: any, config?: DefaultConfigCacheModel) {\r\n  if (_keyshEnabled !== true) return;\r\n  if (key == null) return;\r\n  if (value === undefined) return;\r\n\r\n  const _hash = __objToHash(argsToHash);\r\n\r\n  const _obj = {\r\n    value,\r\n    date: Date.now().valueOf(),\r\n    localStored: false,\r\n    config: {\r\n      ...defaultConfig,\r\n      ...(config || (store_state[key] || {})?.config),\r\n    },\r\n  };\r\n\r\n  //Add Obj\r\n  let stateObjs: StoredValueModelObj = {\r\n    ...store_state[key],\r\n    [_hash]: _obj,\r\n  };\r\n\r\n  //Check MaxItems\r\n  let maxItems = Number(_obj?.config?.maxItems);\r\n  let obj = store_state[key];\r\n  if (obj != null && Object.keys(obj).length > Number(maxItems))\r\n    stateObjs = __sortStoredValueModelByDate(stateObjs, maxItems);\r\n\r\n  store_state[key] = stateObjs;\r\n\r\n  if (false) _log(JSON.stringify({ store_state, _hash, argsToHash }, null, 2));\r\n\r\n  if (__isValidLocalStorageItem(value) && config?.localStorage === true) __updateLocalStorage();\r\n\r\n  //check Promise\r\n  if (__isPromise(value)) {\r\n    value.then(_val => {\r\n      if (_val != null) setCacheValue(key, _val, argsToHash, config);\r\n    });\r\n  }\r\n}\r\n\r\nfunction getCacheValue(key: string, argsToHash?: any): any {\r\n  if (_keyshEnabled !== true) return null;\r\n\r\n  if (true && typeof window !== 'undefined' && _localStorageLoaded === false) __setLocalStoredToStore();\r\n\r\n  if (store_state[key] == null) return store_state[key];\r\n\r\n  const _hash = __objToHash(argsToHash);\r\n  const objKeyValue: StoredValueModel = store_state[key][_hash];\r\n  if (objKeyValue == null) return objKeyValue;\r\n\r\n  if (false && _isTest) _log(JSON.stringify(store_state, null, 2));\r\n\r\n  //Is maxTime\r\n  if ((objKeyValue.config?.maxTime || objKeyValue.config.localStorage) && !__checkValidItemDate(objKeyValue))\r\n    return null;\r\n\r\n  if (objKeyValue.value == null) return objKeyValue.value;\r\n\r\n  if (typeof objKeyValue.value === 'object') return Object.freeze(objKeyValue.value);\r\n\r\n  return objKeyValue.value;\r\n}\r\n\r\nfunction resetCache(key: string, argsToHash?: any) {\r\n  if (key == null) return;\r\n\r\n  if (argsToHash !== undefined) {\r\n    const _hash = __objToHash(argsToHash);\r\n    if (store_state && key in store_state && _hash in store_state[key]) {\r\n      let resetLocalStorage = __isLocalStorageItem(store_state[key][_hash]);\r\n\r\n      delete store_state[key][_hash];\r\n\r\n      if (resetLocalStorage) __updateLocalStorage();\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (store_state && key in store_state) {\r\n    delete store_state[key];\r\n    __updateLocalStorage();\r\n  }\r\n}\r\n\r\nfunction resetAllCaches() {\r\n  store_state = {};\r\n  __clearLocalStorage();\r\n}\r\n\r\nfunction memoFunction(func: Function, config?: DefaultConfigCacheModel, prefixId: string = memoFuncPrefixId): Function {\r\n  let funcName = func.name || '__memoized';\r\n  let funcKey = prefixId + func.name;\r\n\r\n  if (false) _log('funcName', funcName);\r\n\r\n  var object = {\r\n    [funcName]: function(...restArgs) {\r\n      const cache = getCacheValue(funcKey, restArgs);\r\n      if (cache !== undefined) return cache;\r\n\r\n      const res = func.apply(this, restArgs);\r\n      setCacheValue(funcKey, res, restArgs, config);\r\n      return res;\r\n    },\r\n  };\r\n\r\n  return object[funcName];\r\n}\r\n\r\nfunction resetMemoFunction(function_Or_functionName: Function | string, prefixId: string = memoFuncPrefixId): Function {\r\n  let funcKey;\r\n\r\n  if (typeof function_Or_functionName === 'string') {\r\n    funcKey = prefixId + function_Or_functionName;\r\n  } else {\r\n    funcKey = prefixId + function_Or_functionName.name;\r\n  }\r\n\r\n  const memoizedReset = function(...restArgs) {\r\n    if (restArgs !== undefined && restArgs.length) {\r\n      resetCache(funcKey, restArgs);\r\n    } else {\r\n      resetCache(funcKey);\r\n    }\r\n  };\r\n\r\n  return memoizedReset;\r\n}\r\n\r\nfunction memoFunctionDecorator(config?: DefaultConfigCacheModel, prefixId?) {\r\n  const instanceMap = new WeakMap();\r\n  return (target, propertyKey, descriptor) => {\r\n    const input = target[propertyKey]; // eslint-disable-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\r\n\r\n    if (typeof input !== 'function') {\r\n      throw new TypeError('The decorated value must be a function');\r\n    }\r\n\r\n    delete descriptor.value;\r\n    delete descriptor.writable;\r\n\r\n    descriptor.get = function() {\r\n      if (!instanceMap.has(this)) {\r\n        const value = memoFunction(input, config, prefixId);\r\n        instanceMap.set(this, value);\r\n        return value;\r\n      }\r\n      return instanceMap.get(this);\r\n    };\r\n  };\r\n}\r\n\r\nfunction __sortStoredValueModelByDate(StoredValuel: StoredValueModelObj, max: number = Infinity): StoredValueModelObj {\r\n  return Object.entries({ ...StoredValuel })\r\n    .sort(([, a], [, b]) => Number(b.date) - Number(a.date))\r\n    .slice(0, max)\r\n    .reduce((r, [k, v]) => ({ ...r, [k]: v }), {} as any);\r\n}\r\n\r\nfunction __isRxjsObservableObj(value: any) {\r\n  if (value == null) return false;\r\n\r\n  if (__isObservable(value)) return true;\r\n\r\n  return typeof value === 'object' && value.hasOwnProperty('_isScalar') && value.hasOwnProperty('source');\r\n}\r\n\r\nfunction __isFunction(value: any): boolean {\r\n  return value != null && typeof value === 'function';\r\n}\r\n\r\nfunction __isObservable(value: any): boolean {\r\n  if (value?.value != null && __isObservable(value?.value)) return true;\r\n\r\n  return (\r\n    value != null &&\r\n    typeof value === 'object' &&\r\n    (value?.constructor?.name === 'Observable' || (__isFunction(value.lift) && __isFunction(value.subscribe)))\r\n  );\r\n}\r\n\r\nfunction __isPromise(value: any): boolean {\r\n  if (value?.value != null && __isPromise(value?.value)) return true;\r\n\r\n  return value != null && Object.prototype.toString.call(value) === '[object Promise]';\r\n}\r\n\r\nfunction __isValidLocalStorageItem(val): boolean {\r\n  return !__isRxjsObservableObj(val) && !__isPromise(val);\r\n}\r\n\r\nfunction __isLocalStorageItem(val, isToLoadData = false): boolean {\r\n  let rv = __isValidLocalStorageItem(val) && val?.config?.localStorage === true && val?.date > 0;\r\n\r\n  if (isToLoadData) {\r\n    rv = rv && val.localStored === true;\r\n  }\r\n\r\n  return rv;\r\n}\r\n\r\nfunction __filterLocalStorageItems(state: any, isToLoadData?: boolean) {\r\n  if (state == null) return state;\r\n\r\n  let rv = {};\r\n  let _state = { ...state };\r\n\r\n  Object.entries(_state).forEach(([key, value]) => {\r\n    if (value != null && typeof value === 'object' && Object.keys(value).length > 0) {\r\n      //SUBKEY\r\n      rv[key] = { ..._state[key] };\r\n\r\n      Object.entries(value).forEach(([key2, value2]) => {\r\n        if (__isLocalStorageItem(value2, isToLoadData)) {\r\n          rv[key][key2] = { ...value2, localStored: true };\r\n        } else {\r\n          delete rv[key][key2];\r\n        }\r\n      });\r\n\r\n      if (Object.keys(rv[key]).length === 0) {\r\n        if (key in rv) delete rv[key];\r\n      }\r\n    } else {\r\n      if (key in rv) delete rv[key];\r\n    }\r\n  });\r\n\r\n  return rv;\r\n}\r\n\r\nfunction __updateLocalStorage() {\r\n  if (_keyshEnabled !== true || _keyshLocalStorageEnabled !== true) return null;\r\n\r\n  if (!_localStorage?.setItem) return;\r\n\r\n  let store_stateClone = __filterLocalStorageItems(store_state);\r\n\r\n  if (store_stateClone != null && typeof store_stateClone === 'object' && Object.keys(store_stateClone).length > 0) {\r\n    _localStorage.setItem(_localStorageParentKey, JSON.stringify(store_stateClone));\r\n  } else {\r\n    __clearLocalStorage();\r\n  }\r\n\r\n  if (false) _log('[updateLocalStorage]', JSON.stringify(store_stateClone, null, 2));\r\n  if (false) _log('[updateLocalStorage]', JSON.stringify(store_state, null, 2));\r\n}\r\n\r\nfunction __checkValidItemDate(objKeyValue: StoredValueModel): boolean {\r\n  let max = Number(objKeyValue.config?.maxTime || 0);\r\n\r\n  if (objKeyValue.config.localStorage && _localStorageMaxGlobalTime > 0) {\r\n    max = max === 0 ? _localStorageMaxGlobalTime : Math.min(max, _localStorageMaxGlobalTime);\r\n  }\r\n\r\n  if (!(max > 0)) return true;\r\n\r\n  let now = Date.now().valueOf();\r\n  let date = Number(objKeyValue.date);\r\n  let maxDate = date + max;\r\n\r\n  return !(now > maxDate);\r\n}\r\n\r\nfunction __getLocalStorageClass() {\r\n  return _localStorage;\r\n}\r\n\r\nfunction __setLocalStoredToStore() {\r\n  if (_keyshEnabled !== true || _keyshLocalStorageEnabled !== true) return null;\r\n\r\n  if (_localStorage?.getItem == null || !_localStorageParentKey?.length) return;\r\n  if (!_isTest && _localStorageLoaded) return;\r\n\r\n  const dataStored = _localStorage.getItem(_localStorageParentKey);\r\n\r\n  if (dataStored == null) return;\r\n\r\n  let storeStateObject = JSON.parse(dataStored);\r\n\r\n  if (storeStateObject != null) {\r\n    store_state = __filterLocalStorageItems(storeStateObject, true);\r\n    _localStorageLoaded = true;\r\n  }\r\n}\r\n\r\nfunction __getLocalStorageGlobalKey() {\r\n  return _localStorageParentKey;\r\n}\r\n\r\nfunction __setLocalStorageGlobals(\r\n  parentKey: string,\r\n  maxGlobalTime: number = null,\r\n  enabled: boolean = null,\r\n  localStorageEnabled: boolean = null\r\n) {\r\n  if (parentKey == null && maxGlobalTime == null && enabled == null && localStorageEnabled == null) return;\r\n\r\n  __clearLocalStorage();\r\n\r\n  if (parentKey != null) _localStorageParentKey = parentKey;\r\n\r\n  if (maxGlobalTime != null) _localStorageMaxGlobalTime = maxGlobalTime;\r\n\r\n  if (enabled != null) _keyshEnabled = !!enabled;\r\n\r\n  if (localStorageEnabled != null) _keyshLocalStorageEnabled = !!localStorageEnabled;\r\n}\r\n\r\nfunction __clearLocalStorage() {\r\n  if (_localStorage?.removeItem == null) return;\r\n\r\n  _localStorage.removeItem(_localStorageParentKey);\r\n\r\n  _localStorageLoaded = false;\r\n}\r\n\r\nfunction __getStoreState() {\r\n  if (store_state == null) return null;\r\n\r\n  return Object.freeze({ ...store_state } as any);\r\n}\r\n\r\nfunction __simulateRefresh() {\r\n  if (_isTest) {\r\n    if (false) _log('[simulateRefresh]');\r\n    store_state = {};\r\n    __setLocalStoredToStore();\r\n  }\r\n}\r\n\r\nconst __simpleCacheStore = {\r\n  setCacheValue,\r\n  getCacheValue,\r\n  resetCache,\r\n  resetAllCaches,\r\n  memoFunction,\r\n  memoFunctionDecorator,\r\n  resetMemoFunction,\r\n  __getLocalStorageClass,\r\n  __setLocalStoredToStore,\r\n  __clearLocalStorage,\r\n  __getLocalStorageGlobalKey,\r\n  __getStoreState,\r\n  __sortStoredValueModelByDate,\r\n  __simulateRefresh,\r\n  __setLocalStorageGlobals,\r\n  __isPromise,\r\n};\r\n\r\nexport { __simpleCacheStore };\r\n","import { MonoTypeOperatorFunction, of, ReplaySubject, Subscriber, Subscription } from 'rxjs';\r\nimport { Observable } from 'rxjs/internal/Observable';\r\nimport { isObservable } from 'rxjs/internal/util/isObservable';\r\nimport { shareReplay, tap } from 'rxjs/operators';\r\nimport { DefaultConfigCacheModel, __simpleCacheStore } from './simple-cache-store';\r\n\r\nconst getRxjsObservableCacheValue = (key: string, argsToHash?: any): Observable<any> => {\r\n  const cache = __simpleCacheStore.getCacheValue(key, argsToHash);\r\n\r\n  if (cache == null) return cache;\r\n\r\n  if (isObservable(cache)) return cache;\r\n\r\n  return of(cache);\r\n};\r\n\r\nconst setRxjsObservableCacheValue = (\r\n  stream: Observable<any>,\r\n  key: string,\r\n  argsToHash?: any,\r\n  config?: DefaultConfigCacheModel\r\n): Observable<any> => {\r\n  if (stream == null || key == null) return of(null);\r\n\r\n  const setCache = ($data: any) => {\r\n    if ($data != null) __simpleCacheStore.setCacheValue(key, $data, argsToHash, config);\r\n  };\r\n\r\n  let useCacheReplay = config?.useCacheReplay !== false;\r\n\r\n  if (useCacheReplay === false) {\r\n    console.log(stream);\r\n    setCache(stream);\r\n    return stream.pipe(tap((_data: any) => setCache(_data)));\r\n  }\r\n\r\n  let cacheReplay = stream.pipe(shareReplay());\r\n\r\n  setCache(cacheReplay);\r\n\r\n  return cacheReplay.pipe(\r\n    shareReplay(),\r\n    tap((_data: any) => setCache(_data))\r\n  );\r\n};\r\n\r\nconst observableCache = (\r\n  stream: Observable<any>,\r\n  key: string,\r\n  argsToHash?: any,\r\n  config?: DefaultConfigCacheModel,\r\n  forceUpdate = false\r\n) => {\r\n  const cache = getRxjsObservableCacheValue(key, argsToHash);\r\n\r\n  if (forceUpdate === false && cache != null) return cache;\r\n\r\n  return setRxjsObservableCacheValue(stream, key, argsToHash, config);\r\n};\r\n\r\nexport function kayshOperator<T>(\r\n  key: string,\r\n  argsToHash?: any,\r\n  config?: DefaultConfigCacheModel,\r\n  forceUpdate = false\r\n): MonoTypeOperatorFunction<T> {\r\n  function __shareReplayOperator<T>() {\r\n    let subject: ReplaySubject<T> | undefined;\r\n    let refCount = 0;\r\n    let subscription: Subscription | undefined;\r\n    let hasError = false;\r\n    let isComplete = false;\r\n\r\n    return function shareReplayOperation(this: Subscriber<T>, source: Observable<T>) {\r\n      refCount++;\r\n      let innerSub: Subscription;\r\n      if (!subject || hasError) {\r\n        hasError = false;\r\n        subject = new ReplaySubject<T>();\r\n        innerSub = subject.subscribe(this);\r\n        subscription = source.subscribe({\r\n          next(value) {\r\n            subject.next(value);\r\n          },\r\n          error(err) {\r\n            hasError = true;\r\n            subject.error(err);\r\n          },\r\n          complete() {\r\n            isComplete = true;\r\n            subscription = undefined;\r\n            subject.complete();\r\n          },\r\n        });\r\n\r\n        if (isComplete) {\r\n          subscription = undefined;\r\n        }\r\n      } else {\r\n        innerSub = subject.subscribe(this);\r\n      }\r\n\r\n      this.add(() => {\r\n        refCount--;\r\n        innerSub.unsubscribe();\r\n        innerSub = undefined;\r\n        if (subscription && !isComplete && refCount === 0) {\r\n          subscription.unsubscribe();\r\n          subscription = undefined;\r\n          subject = undefined;\r\n        }\r\n      });\r\n    };\r\n  }\r\n\r\n  return (source: Observable<T>) => {\r\n    const cacheObs = observableCache(source, key, argsToHash, config, forceUpdate);\r\n    return cacheObs.lift(__shareReplayOperator());\r\n  };\r\n}\r\n\r\nconst kayshFlushOperator = (key: string, argsToHash?: any) => {\r\n  return __simpleCacheStore.resetCache(key, argsToHash);\r\n};\r\n\r\nconst __rxCacheStore = {\r\n  observableCache,\r\n  kayshFlushOperator,\r\n  kayshOperator,\r\n  getRxjsObservableCacheValue,\r\n  setRxjsObservableCacheValue,\r\n  resetCache: __simpleCacheStore.resetCache,\r\n  resetAllCaches: __simpleCacheStore.resetAllCaches,\r\n};\r\n\r\nexport { __rxCacheStore as __rxjsCacheStore };\r\n","import { __rxjsCacheStore } from './lib/rxjs-cache-store';\r\nimport { __simpleCacheStore } from './lib/simple-cache-store';\r\n\r\nconst kayshOperator = __rxjsCacheStore.kayshOperator;\r\nconst kayshFlushOperator = __rxjsCacheStore.kayshFlushOperator;\r\n\r\nconst kayshDecorator = __simpleCacheStore.memoFunctionDecorator;\r\nconst kayshMemFunction = __simpleCacheStore.memoFunction;\r\nconst kayshFlushMemFunction = __simpleCacheStore.resetMemoFunction;\r\nconst kayshFlushAll = __simpleCacheStore.resetAllCaches;\r\nconst kayshFlushValue = __simpleCacheStore.resetCache;\r\n\r\nconst simpleKaysh = __simpleCacheStore;\r\nconst rxjsKaysh = __rxjsCacheStore;\r\n\r\nexport {\r\n  kayshOperator,\r\n  kayshFlushOperator,\r\n  kayshDecorator,\r\n  kayshFlushMemFunction,\r\n  kayshFlushAll,\r\n  kayshFlushValue,\r\n  kayshMemFunction,\r\n  simpleKaysh,\r\n  rxjsKaysh,\r\n};\r\n"],"names":["__strToHash","str","hash","i","chr","length","charCodeAt","toString","getShortValue","val","Number","isInteger","String","Array","isArray","__objToHash","fast","undefined","shortValue","JSON","stringify","_localStorageParentKey","_localStorageMaxGlobalTime","_localStorage","_localStorageLoaded","_keyshEnabled","_keyshLocalStorageEnabled","memoFuncPrefixId","window","localStorage","defaultConfig","maxTime","maxItems","useCacheReplay","store_state","setCacheValue","key","value","argsToHash","config","_hash","_obj","date","Date","now","valueOf","localStored","stateObjs","obj","Object","keys","__sortStoredValueModelByDate","__isValidLocalStorageItem","__updateLocalStorage","__isPromise","then","_val","getCacheValue","__setLocalStoredToStore","objKeyValue","__checkValidItemDate","freeze","resetCache","resetLocalStorage","__isLocalStorageItem","resetAllCaches","__clearLocalStorage","memoFunction","func","prefixId","funcName","name","funcKey","object","restArgs","cache","res","apply","resetMemoFunction","function_Or_functionName","memoizedReset","memoFunctionDecorator","instanceMap","WeakMap","target","propertyKey","descriptor","input","TypeError","writable","get","has","set","StoredValuel","max","Infinity","entries","sort","a","b","slice","reduce","r","k","v","__isRxjsObservableObj","__isObservable","hasOwnProperty","__isFunction","constructor","lift","subscribe","prototype","call","isToLoadData","rv","__filterLocalStorageItems","state","_state","forEach","key2","value2","setItem","store_stateClone","Math","min","maxDate","__getLocalStorageClass","getItem","dataStored","storeStateObject","parse","__getLocalStorageGlobalKey","__setLocalStorageGlobals","parentKey","maxGlobalTime","enabled","localStorageEnabled","removeItem","__getStoreState","__simulateRefresh","__simpleCacheStore","getRxjsObservableCacheValue","isObservable","of","setRxjsObservableCacheValue","stream","setCache","$data","console","log","pipe","tap","_data","cacheReplay","shareReplay","observableCache","forceUpdate","kayshOperator","__shareReplayOperator","subject","refCount","subscription","hasError","isComplete","shareReplayOperation","source","innerSub","ReplaySubject","next","error","err","complete","add","unsubscribe","cacheObs","kayshFlushOperator","__rxCacheStore","__rxjsCacheStore","kayshDecorator","kayshMemFunction","kayshFlushMemFunction","kayshFlushAll","kayshFlushValue","simpleKaysh","rxjsKaysh"],"mappings":"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"}