"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n=require("rxjs"),t=require("rxjs/internal/util/isObservable"),r=require("rxjs/operators");function l(){return(l=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function u(e,n){if(void 0===n&&(n=!0),void 0===e)return"__undefined__";if(null===e)return"__null__";if(n){var t=function(e){if(Number.isInteger(e)&&String(e).length)return"num_"+e;if("string"==typeof e)return 0===e.length?"emptyString__":"str_"+e;if(Array.isArray(e)){if(0===e.length)return"emptyArray__";if(1===e.length){if(Number.isInteger(e[0])&&String(e[0]).length)return"_num_"+e[0];if("string"==typeof e[0])return 0===e[0].length?"_emptyString__":"_str_"+e[0]}}return null}(e);if(null!=t&&t.length>0&&t.length<32)return t}return function(e){void 0===e&&(e="");var n,t=0;for(n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t.toString(36)}(JSON.stringify(e))}var o,i="KAYSH-V1",a=0,c=!1,s=!0,f=!0;o=null==(e=window)?void 0:e.localStorage;var v={localStorage:!1,maxTime:0,maxItems:10},h={};function d(e,n,t,r){var o,i,a;if(!0===s&&null!=e&&void 0!==n){var c=u(t),f={value:n,date:Date.now().valueOf(),localStored:!1,config:l({},v,r||(null==(o=h[e]||{})?void 0:o.config))},g=l({},h[e],((i={})[c]=f,i)),m=Number(null==f||null==(a=f.config)?void 0:a.maxItems),p=h[e];null!=p&&Object.keys(p).length>Number(m)&&(g=b(g,m)),h[e]=g,O(n)&&!0===(null==r?void 0:r.localStorage)&&C(),_(n)&&n.then((function(n){null!=n&&d(e,n,t,r)}))}}function g(e,n){var t;if(!0!==s)return null;if("undefined"!=typeof window&&!1===c&&x(),null==h[e])return h[e];var r=u(n),l=h[e][r];return null==l?l:(null!=(t=l.config)&&t.maxTime||l.config.localStorage)&&!function(e){var n,t=Number((null==(n=e.config)?void 0:n.maxTime)||0);return e.config.localStorage&&a>0&&(t=0===t?a:Math.min(t,a)),!(t>0&&Date.now().valueOf()>Number(e.date)+t)}(l)?null:null==l.value?l.value:"object"==typeof l.value?Object.freeze(l.value):l.value}function m(e,n){if(null!=e)if(void 0===n)h&&e in h&&(delete h[e],C());else{var t=u(n);if(h&&e in h&&t in h[e]){var r=S(h[e][t]);delete h[e][t],r&&C()}}}function p(e,n,t){var r;void 0===t&&(t="KAYSH-CACHE-MEMO-FUNC__");var l=e.name||"__memoized",u=t+e.name;return((r={})[l]=function(){for(var t=arguments.length,r=new Array(t),l=0;l<t;l++)r[l]=arguments[l];var o=g(u,r);if(void 0!==o)return o;var i=e.apply(this,r);return d(u,i,r,n),i},r)[l]}function b(e,n){return void 0===n&&(n=Infinity),Object.entries(l({},e)).sort((function(e,n){var t=e[1];return Number(n[1].date)-Number(t.date)})).slice(0,n).reduce((function(e,n){var t;return l({},e,((t={})[n[0]]=n[1],t))}),{})}function y(e){return null!=e&&"function"==typeof e}function _(e){return!(null==(null==e?void 0:e.value)||!_(null==e?void 0:e.value))||null!=e&&"[object Promise]"===Object.prototype.toString.call(e)}function O(e){return!(null!=(n=e)&&(function e(n){var t;return!(null==(null==n?void 0:n.value)||!e(null==n?void 0:n.value))||null!=n&&"object"==typeof n&&("Observable"===(null==n||null==(t=n.constructor)?void 0:t.name)||y(n.lift)&&y(n.subscribe))}(n)||"object"==typeof n&&n.hasOwnProperty("_isScalar")&&n.hasOwnProperty("source"))||_(e));var n}function S(e,n){var t;void 0===n&&(n=!1);var r=O(e)&&!0===(null==e||null==(t=e.config)?void 0:t.localStorage)&&(null==e?void 0:e.date)>0;return n&&(r=r&&!0===e.localStored),r}function j(e,n){if(null==e)return e;var t={},r=l({},e);return Object.entries(r).forEach((function(e){var u=e[0],o=e[1];null!=o&&"object"==typeof o&&Object.keys(o).length>0?(t[u]=l({},r[u]),Object.entries(o).forEach((function(e){var r=e[0],o=e[1];S(o,n)?t[u][r]=l({},o,{localStored:!0}):delete t[u][r]})),0===Object.keys(t[u]).length&&u in t&&delete t[u]):u in t&&delete t[u]})),t}function C(){var e;if(!0!==s||!0!==f)return null;if(null!=(e=o)&&e.setItem){var n=j(h);null!=n&&"object"==typeof n&&Object.keys(n).length>0?o.setItem(i,JSON.stringify(n)):k()}}function x(){var e,n;if(!0!==s||!0!==f)return null;if(null!=(null==(e=o)?void 0:e.getItem)&&null!=(n=i)&&n.length&&!c){var t=o.getItem(i);if(null!=t){var r=JSON.parse(t);null!=r&&(h=j(r,!0),c=!0)}}}function k(){var e;null!=(null==(e=o)?void 0:e.removeItem)&&(o.removeItem(i),c=!1)}var w={setCacheValue:d,getCacheValue:g,resetCache:m,resetAllCaches:function(){h={},k()},memoFunction:p,memoFunctionDecorator:function(e,n){var t=new WeakMap;return function(r,l,u){var o=r[l];if("function"!=typeof o)throw new TypeError("The decorated value must be a function");delete u.value,delete u.writable,u.get=function(){if(!t.has(this)){var r=p(o,e,n);return t.set(this,r),r}return t.get(this)}}},resetMemoFunction:function(e,n){var t;return void 0===n&&(n="KAYSH-CACHE-MEMO-FUNC__"),t="string"==typeof e?n+e:n+e.name,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];void 0!==n&&n.length?m(t,n):m(t)}},__getLocalStorageClass:function(){return o},__setLocalStoredToStore:x,__clearLocalStorage:k,__getLocalStorageGlobalKey:function(){return i},__getStoreState:function(){return null==h?null:Object.freeze(l({},h))},__sortStoredValueModelByDate:b,__simulateRefresh:function(){},__setLocalStorageGlobals:function(e,n,t,r){void 0===n&&(n=null),void 0===t&&(t=null),void 0===r&&(r=null),null==e&&null==n&&null==t&&null==r||(k(),null!=e&&(i=e),null!=n&&(a=n),null!=t&&(s=!!t),null!=r&&(f=!!r))},__isPromise:_},A=function(e,r){var l=w.getCacheValue(e,r);return null==l||t.isObservable(l)?l:n.of(l)},F=function(e,t,l,u){if(null==e||null==t)return n.of(null);var o=function(e){null!=e&&w.setCacheValue(t,e,l,u)},i=e.pipe(r.shareReplay());return o(i),i.pipe(r.shareReplay(),r.tap((function(e){return o(e)})))},N=function(e,n,t,r,l){void 0===l&&(l=!1);var u=A(n,t);return!1===l&&null!=u?u:F(e,n,t,r)},M={observableCache:N,kayshFlushOperator:function(e,n){return w.resetCache(e,n)},kayshOperator:function(e,t,r,l){return void 0===l&&(l=!1),function(u){var o,i,a,c,s;return N(u,e,t,r,l).lift((a=0,c=!1,s=!1,function(e){var t;a++,!o||c?(c=!1,o=new n.ReplaySubject,t=o.subscribe(this),i=e.subscribe({next:function(e){o.next(e)},error:function(e){c=!0,o.error(e)},complete:function(){s=!0,i=void 0,o.complete()}}),s&&(i=void 0)):t=o.subscribe(this),this.add((function(){a--,t.unsubscribe(),t=void 0,i&&!s&&0===a&&(i.unsubscribe(),i=void 0,o=void 0)}))}))}},getRxjsObservableCacheValue:A,setRxjsObservableCacheValue:F,resetCache:w.resetCache,resetAllCaches:w.resetAllCaches},I=M.kayshOperator,V=M.kayshFlushOperator,E=w.memoFunction,D=w.resetMemoFunction,K=w.resetAllCaches,P=w.resetCache,R=w,T=M;exports.kayshDecorator=w.memoFunctionDecorator,exports.kayshFlushAll=K,exports.kayshFlushMemFunction=D,exports.kayshFlushOperator=V,exports.kayshFlushValue=P,exports.kayshMemFunction=E,exports.kayshOperator=I,exports.rxjsKaysh=T,exports.simpleKaysh=R;
//# sourceMappingURL=kaysh.cjs.production.min.js.map
