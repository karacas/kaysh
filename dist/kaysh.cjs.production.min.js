"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n=require("rxjs"),t=require("rxjs/internal/util/isObservable"),r=require("rxjs/operators");function l(){return(l=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function u(e,n){if(void 0===n&&(n=!0),void 0===e)return"__undefined__";if(null===e)return"__null__";if(n){var t=function(e){if(Number.isInteger(e)&&String(e).length)return"num_"+e;if("string"==typeof e)return 0===e.length?"emptyString__":"str_"+e;if(Array.isArray(e)){if(0===e.length)return"emptyArray__";if(1===e.length){if(Number.isInteger(e[0])&&String(e[0]).length)return"_num_"+e[0];if("string"==typeof e[0])return 0===e[0].length?"_emptyString__":"_str_"+e[0]}}return null}(e);if(null!=t&&t.length>0&&t.length<32)return t}return function(e){void 0===e&&(e="");var n,t=0;for(n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t.toString(36)}(JSON.stringify(e))}var o,i="KAYSH-V1",a=0,c=!1,f=!0,s=!0;o=null==(e=window)?void 0:e.localStorage;var v={localStorage:!1,maxTime:0,maxItems:10},g={};function d(e,n,t,r){var o,i,a;if(!0===f&&null!=e&&void 0!==n){var c=u(t),s={value:n,date:Date.now().valueOf(),localStored:!1,config:l({},v,r||(null==(o=g[e]||{})?void 0:o.config))},h=l({},g[e],((i={})[c]=s,i)),_=Number(null==s||null==(a=s.config)?void 0:a.maxItems),m=g[e];null!=m&&Object.keys(m).length>Number(_)&&(h=b(h,_)),g[e]=h,S(n)&&!0===(null==r?void 0:r.localStorage)&&C(),y(n)&&n.then((function(n){null!=n&&d(e,n,t,r)}))}}function h(e,n){var t;if(!0!==f)return null;if("undefined"!=typeof window&&!1===c&&x(),null==g[e])return g[e];var r=u(n),l=g[e][r];return null==l?l:(null!=(t=l.config)&&t.maxTime||l.config.localStorage)&&!function(e){var n,t=Number(null==(n=e.config)?void 0:n.maxTime);return e.config.localStorage&&a>0&&(t=0===t?a:Math.min(t,a)),!(t>0&&Date.now().valueOf()>Number(e.date)+t)}(l)?null:null==l.value?l.value:"object"==typeof l.value?Object.freeze(l.value):l.value}function _(e,n){if(null!=e)if(void 0===n)g&&e in g&&(delete g[e],C());else{var t=u(n);if(g&&e in g&&t in g[e]){var r=j(g[e][t]);delete g[e][t],r&&C()}}}function m(e,n,t){var r;void 0===n&&(n="KAYSH-CACHE-MEMO-FUNC__");var l=e.name||"__memoized",u=n+e.name;return((r={})[l]=function(){for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];var o=h(u,r);if(void 0!==o)return o;var i=e.apply(this,r);return d(u,i,r,t),i},r)[l]}function b(e,n){return void 0===n&&(n=Infinity),Object.entries(l({},e)).sort((function(e,n){var t=e[1];return Number(n[1].date)-Number(t.date)})).slice(0,n).reduce((function(e,n){var t;return l({},e,((t={})[n[0]]=n[1],t))}),{})}function p(e){return null!=e&&"function"==typeof e}function y(e){return null!=e&&"[object Promise]"===Object.prototype.toString.call(e)}function S(e){return!(null!=(n=e)&&(function(e){return null!=e&&"object"==typeof e&&p(e.lift)&&p(e.subscribe)}(n)||"object"==typeof n&&"_isScalar"in n&&"source"in n)||y(e));var n}function j(e,n){var t;void 0===n&&(n=!1);var r=S(e)&&!0===(null==e||null==(t=e.config)?void 0:t.localStorage)&&(null==e?void 0:e.date)>0;return n&&(r=r&&!0===e.localStored),r}function O(e,n){if(null==e)return e;var t={},r=l({},e);return Object.entries(r).forEach((function(e){var u=e[0],o=e[1];null!=o&&"object"==typeof o&&Object.keys(o).length>0?(t[u]=l({},r[u]),Object.entries(o).forEach((function(e){var r=e[0],o=e[1];j(o,n)?t[u][r]=l({},o,{localStored:!0}):delete t[u][r]})),0===Object.keys(t[u]).length&&u in t&&delete t[u]):u in t&&delete t[u]})),t}function C(){var e;if(!0!==f||!0!==s)return null;if(null!=(e=o)&&e.setItem){var n=O(g);null!=n&&"object"==typeof n&&Object.keys(n).length>0?o.setItem(i,JSON.stringify(n)):A()}}function x(){var e,n;if(!0!==f||!0!==s)return null;if(null!=(null==(e=o)?void 0:e.getItem)&&null!=(n=i)&&n.length&&!c){var t=o.getItem(i);if(null!=t){var r=JSON.parse(t);null!=r&&(g=O(r,!0),c=!0)}}}function A(){var e;null!=(null==(e=o)?void 0:e.removeItem)&&(o.removeItem(i),c=!1)}var w={setCacheValue:d,getCacheValue:h,resetCache:_,resetAllCaches:function(){g={},A()},memoFunction:m,memoFunctionDecorator:function(e,n){var t=new WeakMap;return function(r,l,u){var o=r[l];if("function"!=typeof o)throw new TypeError("The decorated value must be a function");delete u.value,delete u.writable,u.get=function(){if(!t.has(this)){var r=m(o,n,e);return t.set(this,r),r}return t.get(this)}}},resetMemoFunction:function(e,n){var t;return void 0===n&&(n="KAYSH-CACHE-MEMO-FUNC__"),t="string"==typeof e?n+e:n+e.name,function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];void 0!==n&&n.length?_(t,n):_(t)}},__getLocalStorageClass:function(){return o},__setLocalStoredToStore:x,__clearLocalStorage:A,__getLocalStorageGlobalKey:function(){return i},__getStoreState:function(){return null==g?null:Object.freeze(l({},g))},__sortStoredValueModelByDate:b,__simulateRefresh:function(){},__setLocalStorageGlobals:function(e,n,t,r){void 0===n&&(n=null),void 0===t&&(t=null),void 0===r&&(r=null),null==e&&null==n||(A(),null!=e&&(i=e),null!=n&&(a=n),null!=t&&(f=!!t),null!=r&&(s=!!r))},__isPromise:y};exports.rxjsKaysh={getRxjsObservableCacheValue:function(e,r){var l=w.getCacheValue(e,r);return null==l||t.isObservable(l)?l:n.of(l)},setRxjsObservableCacheValue:function(e,t,l,u){if(null==e||null==t)return n.of(null);var o=function(e){null!=e&&w.setCacheValue(t,e,l,u)};return o(e.pipe(r.shareReplay())),e.pipe(r.tap((function(e){return o(e)})),r.shareReplay())},resetCache:w.resetCache,resetAllCaches:w.resetAllCaches},exports.simpleKaysh=w;
//# sourceMappingURL=kaysh.cjs.production.min.js.map
